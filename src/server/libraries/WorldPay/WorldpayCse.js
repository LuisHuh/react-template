//  Copyright (c) 2015 Worldpay. All rights reserved.
//
//  License information can be found here: https://github.com/Worldpay/worldpay-cse-lib-javascript/blob/master/LICENSE
//

!function(a,b){"use strict";function c(a){throw a}function d(a,b,d){4!==b.length&&c(new Ja.exception.invalid("invalid aes block size"));var e=a.b[d],f=b[0]^e[0],g=b[d?3:1]^e[1],h=b[2]^e[2];b=b[d?1:3]^e[3];var i,j,k,l,m=e.length/4-2,n=4,o=[0,0,0,0];i=a.k[d],a=i[0];var p=i[1],q=i[2],r=i[3],s=i[4];for(l=0;l<m;l++)i=a[f>>>24]^p[g>>16&255]^q[h>>8&255]^r[255&b]^e[n],j=a[g>>>24]^p[h>>16&255]^q[b>>8&255]^r[255&f]^e[n+1],k=a[h>>>24]^p[b>>16&255]^q[f>>8&255]^r[255&g]^e[n+2],b=a[b>>>24]^p[f>>16&255]^q[g>>8&255]^r[255&h]^e[n+3],n+=4,f=i,g=j,h=k;for(l=0;4>l;l++)o[d?3&-l:l]=s[f>>>24]<<24^s[g>>16&255]<<16^s[h>>8&255]<<8^s[255&b]^e[n++],i=f,f=g,g=h,h=b,b=i;return o}function e(a,b){var c,d,e,f=b.slice(0),g=a.r,h=a.b,i=g[0],j=g[1],k=g[2],l=g[3],m=g[4],n=g[5],o=g[6],p=g[7];for(c=0;64>c;c++)16>c?d=f[c]:(d=f[c+1&15],e=f[c+14&15],d=f[15&c]=(d>>>7^d>>>18^d>>>3^d<<25^d<<14)+(e>>>17^e>>>19^e>>>10^e<<15^e<<13)+f[15&c]+f[c+9&15]|0),d=d+p+(m>>>6^m>>>11^m>>>25^m<<26^m<<21^m<<7)+(o^m&(n^o))+h[c],p=o,o=n,n=m,m=l+d|0,l=k,k=j,j=i,i=d+(j&k^l&(j^k))+(j>>>2^j>>>13^j>>>22^j<<30^j<<19^j<<10)|0;g[0]=g[0]+i|0,g[1]=g[1]+j|0,g[2]=g[2]+k|0,g[3]=g[3]+l|0,g[4]=g[4]+m|0,g[5]=g[5]+n|0,g[6]=g[6]+o|0,g[7]=g[7]+p|0}function f(a,b){var c,d=Ja.random.w[a],e=[];for(c in d)d.hasOwnProperty(c)&&e.push(d[c]);for(c=0;c<e.length;c++)e[c](b)}function g(a){"undefined"!=typeof window&&window.performance&&"function"==typeof window.performance.now?Ja.random.addEntropy(window.performance.now(),a,"loadtime"):Ja.random.addEntropy((new Date).valueOf(),a,"loadtime")}function h(a){a.b=i(a).concat(i(a)),a.A=new Ja.cipher.aes(a.b)}function i(a){for(var b=0;4>b&&(a.f[b]=a.f[b]+1|0,!a.f[b]);b++);return a.A.encrypt(a.f)}function j(a,b){return function(){b.apply(a,arguments)}}function k(a,b,c){null!=a&&("number"==typeof a?this.fromNumber(a,b,c):null==b&&"string"!=typeof a?this.fromString(a,256):this.fromString(a,b))}function l(){return new k(null)}function m(a,b,c,d,e,f){for(var g=16383&b,h=b>>14;--f>=0;){var i=16383&this[a],j=this[a++]>>14,k=h*i+j*g;i=g*i+((16383&k)<<14)+c[d]+e,e=(i>>28)+(k>>14)+h*j,c[d++]=268435455&i}return e}function n(a){return Ua.charAt(a)}function o(a,b){var c=Va[a.charCodeAt(b)];return null==c?-1:c}function p(a){for(var b=this.t-1;b>=0;--b)a[b]=this[b];a.t=this.t,a.s=this.s}function q(a){this.t=1,this.s=a<0?-1:0,a>0?this[0]=a:a<-1?this[0]=a+this.DV:this.t=0}function r(a){var b=l();return b.fromInt(a),b}function s(a,b){var c;if(16==b)c=4;else if(8==b)c=3;else if(256==b)c=8;else if(2==b)c=1;else if(32==b)c=5;else{if(4!=b)return void this.fromRadix(a,b);c=2}this.t=0,this.s=0;for(var d=a.length,e=!1,f=0;--d>=0;){var g=8==c?255&a[d]:o(a,d);g<0?"-"==a.charAt(d)&&(e=!0):(e=!1,0==f?this[this.t++]=g:f+c>this.DB?(this[this.t-1]|=(g&(1<<this.DB-f)-1)<<f,this[this.t++]=g>>this.DB-f):this[this.t-1]|=g<<f,(f+=c)>=this.DB&&(f-=this.DB))}8==c&&0!=(128&a[0])&&(this.s=-1,f>0&&(this[this.t-1]|=(1<<this.DB-f)-1<<f)),this.clamp(),e&&k.ZERO.subTo(this,this)}function t(){for(var a=this.s&this.DM;this.t>0&&this[this.t-1]==a;)--this.t}function u(a){if(this.s<0)return"-"+this.negate().toString(a);var b;if(16==a)b=4;else if(8==a)b=3;else if(2==a)b=1;else if(32==a)b=5;else{if(4!=a)return this.toRadix(a);b=2}var c,d=(1<<b)-1,e=!1,f="",g=this.t,h=this.DB-g*this.DB%b;if(g-- >0)for(h<this.DB&&(c=this[g]>>h)>0&&(e=!0,f=n(c));g>=0;)h<b?(c=(this[g]&(1<<h)-1)<<b-h,c|=this[--g]>>(h+=this.DB-b)):(c=this[g]>>(h-=b)&d,h<=0&&(h+=this.DB,--g)),c>0&&(e=!0),e&&(f+=n(c));return e?f:"0"}function v(){var a=l();return k.ZERO.subTo(this,a),a}function w(){return this.s<0?this.negate():this}function x(a){var b=this.s-a.s;if(0!=b)return b;var c=this.t;if(0!=(b=c-a.t))return this.s<0?-b:b;for(;--c>=0;)if(0!=(b=this[c]-a[c]))return b;return 0}function y(a){var b,c=1;return 0!=(b=a>>>16)&&(a=b,c+=16),0!=(b=a>>8)&&(a=b,c+=8),0!=(b=a>>4)&&(a=b,c+=4),0!=(b=a>>2)&&(a=b,c+=2),0!=(b=a>>1)&&(a=b,c+=1),c}function z(){return this.t<=0?0:this.DB*(this.t-1)+y(this[this.t-1]^this.s&this.DM)}function A(a,b){var c;for(c=this.t-1;c>=0;--c)b[c+a]=this[c];for(c=a-1;c>=0;--c)b[c]=0;b.t=this.t+a,b.s=this.s}function B(a,b){for(var c=a;c<this.t;++c)b[c-a]=this[c];b.t=Math.max(this.t-a,0),b.s=this.s}function C(a,b){var c,d=a%this.DB,e=this.DB-d,f=(1<<e)-1,g=Math.floor(a/this.DB),h=this.s<<d&this.DM;for(c=this.t-1;c>=0;--c)b[c+g+1]=this[c]>>e|h,h=(this[c]&f)<<d;for(c=g-1;c>=0;--c)b[c]=0;b[g]=h,b.t=this.t+g+1,b.s=this.s,b.clamp()}function D(a,b){b.s=this.s;var c=Math.floor(a/this.DB);if(c>=this.t)return void(b.t=0);var d=a%this.DB,e=this.DB-d,f=(1<<d)-1;b[0]=this[c]>>d;for(var g=c+1;g<this.t;++g)b[g-c-1]|=(this[g]&f)<<e,b[g-c]=this[g]>>d;d>0&&(b[this.t-c-1]|=(this.s&f)<<e),b.t=this.t-c,b.clamp()}function E(a,b){for(var c=0,d=0,e=Math.min(a.t,this.t);c<e;)d+=this[c]-a[c],b[c++]=d&this.DM,d>>=this.DB;if(a.t<this.t){for(d-=a.s;c<this.t;)d+=this[c],b[c++]=d&this.DM,d>>=this.DB;d+=this.s}else{for(d+=this.s;c<a.t;)d-=a[c],b[c++]=d&this.DM,d>>=this.DB;d-=a.s}b.s=d<0?-1:0,d<-1?b[c++]=this.DV+d:d>0&&(b[c++]=d),b.t=c,b.clamp()}function F(a,b){var c=this.abs(),d=a.abs(),e=c.t;for(b.t=e+d.t;--e>=0;)b[e]=0;for(e=0;e<d.t;++e)b[e+c.t]=c.am(0,d[e],b,e,0,c.t);b.s=0,b.clamp(),this.s!=a.s&&k.ZERO.subTo(b,b)}function G(a){for(var b=this.abs(),c=a.t=2*b.t;--c>=0;)a[c]=0;for(c=0;c<b.t-1;++c){var d=b.am(c,b[c],a,2*c,0,1);(a[c+b.t]+=b.am(c+1,2*b[c],a,2*c+1,d,b.t-c-1))>=b.DV&&(a[c+b.t]-=b.DV,a[c+b.t+1]=1)}a.t>0&&(a[a.t-1]+=b.am(c,b[c],a,2*c,0,1)),a.s=0,a.clamp()}function H(a,b,c){var d=a.abs();if(!(d.t<=0)){var e=this.abs();if(e.t<d.t)return null!=b&&b.fromInt(0),void(null!=c&&this.copyTo(c));null==c&&(c=l());var f=l(),g=this.s,h=a.s,i=this.DB-y(d[d.t-1]);i>0?(d.lShiftTo(i,f),e.lShiftTo(i,c)):(d.copyTo(f),e.copyTo(c));var j=f.t,m=f[j-1];if(0!=m){var n=m*(1<<this.F1)+(j>1?f[j-2]>>this.F2:0),o=this.FV/n,p=(1<<this.F1)/n,q=1<<this.F2,r=c.t,s=r-j,t=null==b?l():b;for(f.dlShiftTo(s,t),c.compareTo(t)>=0&&(c[c.t++]=1,c.subTo(t,c)),k.ONE.dlShiftTo(j,t),t.subTo(f,f);f.t<j;)f[f.t++]=0;for(;--s>=0;){var u=c[--r]==m?this.DM:Math.floor(c[r]*o+(c[r-1]+q)*p);if((c[r]+=f.am(0,u,c,s,0,j))<u)for(f.dlShiftTo(s,t),c.subTo(t,c);c[r]<--u;)c.subTo(t,c)}null!=b&&(c.drShiftTo(j,b),g!=h&&k.ZERO.subTo(b,b)),c.t=j,c.clamp(),i>0&&c.rShiftTo(i,c),g<0&&k.ZERO.subTo(c,c)}}}function I(a){var b=l();return this.abs().divRemTo(a,null,b),this.s<0&&b.compareTo(k.ZERO)>0&&a.subTo(b,b),b}function J(a){this.m=a}function K(a){return a.s<0||a.compareTo(this.m)>=0?a.mod(this.m):a}function L(a){return a}function M(a){a.divRemTo(this.m,null,a)}function N(a,b,c){a.multiplyTo(b,c),this.reduce(c)}function O(a,b){a.squareTo(b),this.reduce(b)}function P(){if(this.t<1)return 0;var a=this[0];if(0==(1&a))return 0;var b=3&a;return b=b*(2-(15&a)*b)&15,b=b*(2-(255&a)*b)&255,b=b*(2-((65535&a)*b&65535))&65535,b=b*(2-a*b%this.DV)%this.DV,b>0?this.DV-b:-b}function Q(a){this.m=a,this.mp=a.invDigit(),this.mpl=32767&this.mp,this.mph=this.mp>>15,this.um=(1<<a.DB-15)-1,this.mt2=2*a.t}function R(a){var b=l();return a.abs().dlShiftTo(this.m.t,b),b.divRemTo(this.m,null,b),a.s<0&&b.compareTo(k.ZERO)>0&&this.m.subTo(b,b),b}function S(a){var b=l();return a.copyTo(b),this.reduce(b),b}function T(a){for(;a.t<=this.mt2;)a[a.t++]=0;for(var b=0;b<this.m.t;++b){var c=32767&a[b],d=c*this.mpl+((c*this.mph+(a[b]>>15)*this.mpl&this.um)<<15)&a.DM;for(c=b+this.m.t,a[c]+=this.m.am(0,d,a,b,0,this.m.t);a[c]>=a.DV;)a[c]-=a.DV,a[++c]++}a.clamp(),a.drShiftTo(this.m.t,a),a.compareTo(this.m)>=0&&a.subTo(this.m,a)}function U(a,b){a.squareTo(b),this.reduce(b)}function V(a,b,c){a.multiplyTo(b,c),this.reduce(c)}function W(){return 0==(this.t>0?1&this[0]:this.s)}function X(a,b){if(a>4294967295||a<1)return k.ONE;var c=l(),d=l(),e=b.convert(this),f=y(a)-1;for(e.copyTo(c);--f>=0;)if(b.sqrTo(c,d),(a&1<<f)>0)b.mulTo(d,e,c);else{var g=c;c=d,d=g}return b.revert(c)}function Y(a,b){var c;return c=a<256||b.isEven()?new J(b):new Q(b),this.exp(a,c)}function Z(){this.i=0,this.j=0,this.S=new Array}function $(a){var b,c,d;for(b=0;b<256;++b)this.S[b]=b;for(c=0,b=0;b<256;++b)c=c+this.S[b]+a[b%a.length]&255,d=this.S[b],this.S[b]=this.S[c],this.S[c]=d;this.i=0,this.j=0}function _(){var a;return this.i=this.i+1&255,this.j=this.j+this.S[this.i]&255,a=this.S[this.i],this.S[this.i]=this.S[this.j],this.S[this.j]=a,this.S[a+this.S[this.i]&255]}function aa(){return new Z}function ba(a){Xa[Ya++]^=255&a,Xa[Ya++]^=a>>8&255,Xa[Ya++]^=a>>16&255,Xa[Ya++]^=a>>24&255,Ya>=Za&&(Ya-=Za)}function ca(){ba((new Date).getTime())}function da(){if(null==Wa){for(ca(),Wa=aa(),Wa.init(Xa),Ya=0;Ya<Xa.length;++Ya)Xa[Ya]=0;Ya=0}return Wa.next()}function ea(a){var b;for(b=0;b<a.length;++b)a[b]=da()}function fa(){}function ga(a,b){return new k(a,b)}function ha(a,b){if(b<a.length+11)return alert("Message too long for RSA"),null;for(var c=new Array,d=a.length-1;d>=0&&b>0;){var e=a.charCodeAt(d--);e<128?c[--b]=e:e>127&&e<2048?(c[--b]=63&e|128,c[--b]=e>>6|192):(c[--b]=63&e|128,c[--b]=e>>6&63|128,c[--b]=e>>12|224)}c[--b]=0;for(var f=new fa,g=new Array;b>2;){for(g[0]=0;0==g[0];)f.nextBytes(g);c[--b]=g[0]}return c[--b]=2,c[--b]=0,new k(c)}function ia(){this.n=null,this.e=0,this.d=null,this.p=null,this.q=null,this.dmp1=null,this.dmq1=null,this.coeff=null}function ja(a,b){null!=a&&null!=b&&a.length>0&&b.length>0?(this.n=ga(a,16),this.e=parseInt(b,16)):alert("Invalid RSA public key")}function ka(a){return a.modPowInt(this.e,this.n)}function la(a){var b=ha(a,this.n.bitLength()+7>>3);if(null==b)return null;var c=this.doPublic(b);if(null==c)return null;var d=c.toString(16);return 0==(1&d.length)?d:"0"+d}function ma(a){var b=a.split("#");if(3!=b.length)throw new Error("Malformed public key");ab={keySeqNo:b[0],exponent:b[1],modulus:b[2]}}function na(a,b){var c=ua(a);return c.length>0?(b&&"function"==typeof b&&b(c),null):qa(JSON.stringify(a))}function oa(a){var b=Ja.codec.utf8String.toBits(a);return Ja.codec.base64url.fromBits(b)}function pa(a){var b=Ja.codec.hex.toBits(a);return Ja.codec.base64url.fromBits(b)}function qa(a){var b={alg:"RSA1_5",enc:"A256GCM",kid:ab.keySeqNo,"com.worldpay.apiVersion":"1.0","com.worldpay.libVersion":"1.0.1","com.worldpay.channel":bb},c=oa(JSON.stringify(b)),d=ta(a,c,256);return c+"."+pa(sa(d.symmetricKeyBytes))+"."+d.ivBase64+"."+d.encryptedDataBase64+"."+d.tagBase64}function ra(a){for(var b=a.length/2,c=new Array(b),d=0;d<b;d++)c[d]=parseInt(a.substring(2*d,2*(d+1)),16);return c}function sa(a){var b=new ia;return b.setPublic(ab.modulus,ab.exponent),b.encrypt(a)}function ta(a,b,c){var d=Ja.random.randomWords(c/32,0),e=Ja.codec.utf8String.toBits(a),f=Ja.random.randomWords(3,0),g=Ja.codec.utf8String.toBits(b),h=128,i=new Ja.cipher.aes(d),j=Ja.mode.gcm.encrypt(i,e,f,g,h),k=Ja.bitArray.bitLength(j),l=Ja.bitArray.bitSlice(j,0,k-h),m=Ja.bitArray.bitSlice(j,k-h,k),n=Ja.codec.hex.fromBits(d),o=ra(n);return{encryptedDataBase64:Ja.codec.base64url.fromBits(l),symmetricKeyBytes:o,tagBase64:Ja.codec.base64url.fromBits(m),ivBase64:Ja.codec.base64url.fromBits(f)}}function ua(a){var b=[],c=a.cardNumber,d=a.cvc,e=a.expiryMonth,f=a.expiryYear,g=a.cardHolderName;Da(Ba(c),b),Da(Aa(d),b),Da(za(g),b);var h=Da(va(e),b),i=Da(wa(f),b);return h&&i&&Da(xa(e,f),b),b}function va(a){return Fa(a)?301:Ea(a,"^[0-9]{2}$")?a<=0||a>12?303:0:302}function wa(a){return Fa(a)?304:Ea(a,"^[0-9]{4}$")?0:305}function xa(a,b){return ya(a,b)?0:306}function ya(a,b){var c=new Date,d=c.getMonth()+1,e=c.getFullYear();return b>e||b==e&&a>=d}function za(a){return Fa(a)?401:Ea(a,"^.{1,30}$")?0:402}function Aa(a){return Ea(a,"^[0-9]{3,4}$")||Fa(a)?0:201}function Ba(a){return Fa(a)?101:Ea(a,"^[0-9]{12,20}$")?Ca(a)?0:103:102}function Ca(a){var b=0,c=0,d=!1;a=a.replace(/\D/g,"");for(var e=a.length-1;e>=0;e--){var f=a.charAt(e);c=parseInt(f,10),d&&(c*=2)>9&&(c-=9),b+=c,d=!d}return b%10==0}function Da(a,b){return 0===a||(b.push(a),!1)}function Ea(a,b){return new RegExp(b).test(a)}function Fa(a){return""===a||!/[^\s]/.test(a)}var Ga;module.exports=Ga;var Ha=void 0,Ia=!1,Ja={cipher:{},hash:{},keyexchange:{},mode:{},misc:{},codec:{},exception:{corrupt:function(a){this.toString=function(){return"CORRUPT: "+this.message},this.message=a},invalid:function(a){this.toString=function(){return"INVALID: "+this.message},this.message=a},bug:function(a){this.toString=function(){return"BUG: "+this.message},this.message=a},notReady:function(a){this.toString=function(){return"NOT READY: "+this.message},this.message=a}}};"undefined"!=typeof module&&module.exports&&(module.exports=Ja),"function"==typeof Ga&&Ga([],function(){return Ja}),Ja.cipher.aes=function(a){this.k[0][0][0]||this.D();var b,d,e,f,g=this.k[0][4],h=this.k[1];b=a.length;var i=1;for(4!==b&&6!==b&&8!==b&&c(new Ja.exception.invalid("invalid aes key size")),this.b=[e=a.slice(0),f=[]],a=b;a<4*b+28;a++)d=e[a-1],(0==a%b||8===b&&4==a%b)&&(d=g[d>>>24]<<24^g[d>>16&255]<<16^g[d>>8&255]<<8^g[255&d],0==a%b&&(d=d<<8^d>>>24^i<<24,i=i<<1^283*(i>>7))),e[a]=e[a-b]^d;for(b=0;a;b++,a--)d=e[3&b?a:a-4],f[b]=4>=a||4>b?d:h[0][g[d>>>24]]^h[1][g[d>>16&255]]^h[2][g[d>>8&255]]^h[3][g[255&d]]},Ja.cipher.aes.prototype={encrypt:function(a){return d(this,a,0)},decrypt:function(a){return d(this,a,1)},k:[[[],[],[],[],[]],[[],[],[],[],[]]],D:function(){var a,b,c,d,e,f,g,h=this.k[0],i=this.k[1],j=h[4],k=i[4],l=[],m=[];for(a=0;256>a;a++)m[(l[a]=a<<1^283*(a>>7))^a]=a;for(b=c=0;!j[b];b^=d||1,c=m[c]||1)for(f=c^c<<1^c<<2^c<<3^c<<4,f=f>>8^255&f^99,j[b]=f,k[f]=b,e=l[a=l[d=l[b]]],g=16843009*e^65537*a^257*d^16843008*b,e=257*l[f]^16843008*f,a=0;4>a;a++)h[a][b]=e=e<<24^e>>>8,i[a][f]=g=g<<24^g>>>8;for(a=0;5>a;a++)h[a]=h[a].slice(0),i[a]=i[a].slice(0)}},Ja.bitArray={bitSlice:function(a,b,c){return a=Ja.bitArray.P(a.slice(b/32),32-(31&b)).slice(1),c===Ha?a:Ja.bitArray.clamp(a,c-b)},extract:function(a,b,c){var d=Math.floor(-b-c&31);return(-32&(b+c-1^b)?a[b/32|0]<<32-d^a[b/32+1|0]>>>d:a[b/32|0]>>>d)&(1<<c)-1},concat:function(a,b){if(0===a.length||0===b.length)return a.concat(b);var c=a[a.length-1],d=Ja.bitArray.getPartial(c);return 32===d?a.concat(b):Ja.bitArray.P(b,d,0|c,a.slice(0,a.length-1))},bitLength:function(a){var b=a.length;return 0===b?0:32*(b-1)+Ja.bitArray.getPartial(a[b-1])},clamp:function(a,b){if(32*a.length<b)return a;a=a.slice(0,Math.ceil(b/32));var c=a.length;return b&=31,0<c&&b&&(a[c-1]=Ja.bitArray.partial(b,a[c-1]&2147483648>>b-1,1)),a},partial:function(a,b,c){return 32===a?b:(c?0|b:b<<32-a)+1099511627776*a},getPartial:function(a){return Math.round(a/1099511627776)||32},equal:function(a,b){if(Ja.bitArray.bitLength(a)!==Ja.bitArray.bitLength(b))return Ia;var c,d=0;for(c=0;c<a.length;c++)d|=a[c]^b[c];return 0===d},P:function(a,b,c,d){var e;for(e=0,d===Ha&&(d=[]);32<=b;b-=32)d.push(c),c=0;if(0===b)return d.concat(a);for(e=0;e<a.length;e++)d.push(c|a[e]>>>b),c=a[e]<<32-b;return e=a.length?a[a.length-1]:0,a=Ja.bitArray.getPartial(e),d.push(Ja.bitArray.partial(b+a&31,32<b+a?c:d.pop(),1)),d},l:function(a,b){return[a[0]^b[0],a[1]^b[1],a[2]^b[2],a[3]^b[3]]},byteswapM:function(a){var b,c;for(b=0;b<a.length;++b)c=a[b],a[b]=c>>>24|c>>>8&65280|(65280&c)<<8|c<<24;return a}},Ja.codec.utf8String={fromBits:function(a){var b,c,d="",e=Ja.bitArray.bitLength(a);for(b=0;b<e/8;b++)0==(3&b)&&(c=a[b/4]),d+=String.fromCharCode(c>>>24),c<<=8;return decodeURIComponent(escape(d))},toBits:function(a){a=unescape(encodeURIComponent(a));var b,c=[],d=0;for(b=0;b<a.length;b++)d=d<<8|a.charCodeAt(b),3==(3&b)&&(c.push(d),d=0);return 3&b&&c.push(Ja.bitArray.partial(8*(3&b),d)),c}},Ja.codec.hex={fromBits:function(a){var b,c="";for(b=0;b<a.length;b++)c+=(0xf00000000000+(0|a[b])).toString(16).substr(4);return c.substr(0,Ja.bitArray.bitLength(a)/4)},toBits:function(a){var b,c,d=[];for(a=a.replace(/\s|0x/g,""),c=a.length,a+="00000000",b=0;b<a.length;b+=8)d.push(0^parseInt(a.substr(b,8),16));return Ja.bitArray.clamp(d,4*c)}},Ja.codec.base64={J:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",fromBits:function(a,b,c){var d="",e=0,f=Ja.codec.base64.J,g=0,h=Ja.bitArray.bitLength(a);for(c&&(f=f.substr(0,62)+"-_"),c=0;6*d.length<h;)d+=f.charAt((g^a[c]>>>e)>>>26),6>e?(g=a[c]<<6-e,e+=26,c++):(g<<=6,e-=6);for(;3&d.length&&!b;)d+="=";return d},toBits:function(a,b){a=a.replace(/\s|=/g,"");var d,e,f=[],g=0,h=Ja.codec.base64.J,i=0;for(b&&(h=h.substr(0,62)+"-_"),d=0;d<a.length;d++)e=h.indexOf(a.charAt(d)),0>e&&c(new Ja.exception.invalid("this isn't base64!")),26<g?(g-=26,f.push(i^e>>>g),i=e<<32-g):(g+=6,i^=e<<32-g);return 56&g&&f.push(Ja.bitArray.partial(56&g,i,1)),f}},Ja.codec.base64url={fromBits:function(a){return Ja.codec.base64.fromBits(a,1,1)},toBits:function(a){return Ja.codec.base64.toBits(a,1)}},Ja.hash.sha256=function(a){this.b[0]||this.D(),a?(this.r=a.r.slice(0),this.o=a.o.slice(0),this.h=a.h):this.reset()},Ja.hash.sha256.hash=function(a){return(new Ja.hash.sha256).update(a).finalize()},Ja.hash.sha256.prototype={blockSize:512,reset:function(){return this.r=this.N.slice(0),this.o=[],this.h=0,this},update:function(a){"string"==typeof a&&(a=Ja.codec.utf8String.toBits(a));var b,c=this.o=Ja.bitArray.concat(this.o,a);for(b=this.h,a=this.h=b+Ja.bitArray.bitLength(a),b=512+b&-512;b<=a;b+=512)e(this,c.splice(0,16));return this},finalize:function(){var a,b=this.o,c=this.r,b=Ja.bitArray.concat(b,[Ja.bitArray.partial(1,1)]);for(a=b.length+2;15&a;a++)b.push(0);for(b.push(Math.floor(this.h/4294967296)),b.push(0|this.h);b.length;)e(this,b.splice(0,16));return this.reset(),c},N:[],b:[],D:function(){function a(a){return 4294967296*(a-Math.floor(a))|0}var b,c=0,d=2;a:for(;64>c;d++){for(b=2;b*b<=d;b++)if(0==d%b)continue a;8>c&&(this.N[c]=a(Math.pow(d,.5))),this.b[c]=a(Math.pow(d,1/3)),c++}}},Ja.mode.ccm={name:"ccm",encrypt:function(a,b,d,e,f){var g,h=b.slice(0),i=Ja.bitArray,j=i.bitLength(d)/8,k=i.bitLength(h)/8;for(f=f||64,e=e||[],7>j&&c(new Ja.exception.invalid("ccm: iv must be at least 7 bytes")),g=2;4>g&&k>>>8*g;g++);return g<15-j&&(g=15-j),d=i.clamp(d,8*(15-g)),b=Ja.mode.ccm.L(a,b,d,e,f,g),h=Ja.mode.ccm.p(a,h,d,b,f,g),i.concat(h.data,h.tag)},decrypt:function(a,b,d,e,f){f=f||64,e=e||[];var g=Ja.bitArray,h=g.bitLength(d)/8,i=g.bitLength(b),j=g.clamp(b,i-f),k=g.bitSlice(b,i-f),i=(i-f)/8;for(7>h&&c(new Ja.exception.invalid("ccm: iv must be at least 7 bytes")),b=2;4>b&&i>>>8*b;b++);return b<15-h&&(b=15-h),d=g.clamp(d,8*(15-b)),j=Ja.mode.ccm.p(a,j,d,k,f,b),a=Ja.mode.ccm.L(a,j.data,d,e,f,b),g.equal(j.tag,a)||c(new Ja.exception.corrupt("ccm: tag doesn't match")),j.data},L:function(a,b,d,e,f,g){var h=[],i=Ja.bitArray,j=i.l;if(f/=8,(f%2||4>f||16<f)&&c(new Ja.exception.invalid("ccm: invalid tag length")),(4294967295<e.length||4294967295<b.length)&&c(new Ja.exception.bug("ccm: can't deal with 4GiB or more data")),g=[i.partial(8,(e.length?64:0)|f-2<<2|g-1)],g=i.concat(g,d),g[3]|=i.bitLength(b)/8,g=a.encrypt(g),e.length)for(d=i.bitLength(e)/8,65279>=d?h=[i.partial(16,d)]:4294967295>=d&&(h=i.concat([i.partial(16,65534)],[d])),h=i.concat(h,e),e=0;e<h.length;e+=4)g=a.encrypt(j(g,h.slice(e,e+4).concat([0,0,0])));for(e=0;e<b.length;e+=4)g=a.encrypt(j(g,b.slice(e,e+4).concat([0,0,0])));return i.clamp(g,8*f)},p:function(a,b,c,d,e,f){var g,h=Ja.bitArray;g=h.l;var i=b.length,j=h.bitLength(b);if(c=h.concat([h.partial(8,f-1)],c).concat([0,0,0]).slice(0,4),d=h.bitSlice(g(d,a.encrypt(c)),0,e),!i)return{tag:d,data:[]};for(g=0;g<i;g+=4)c[3]++,e=a.encrypt(c),b[g]^=e[0],b[g+1]^=e[1],b[g+2]^=e[2],b[g+3]^=e[3];return{tag:d,data:h.clamp(b,j)}}},Ja.mode.ocb2={name:"ocb2",encrypt:function(a,b,d,e,f,g){128!==Ja.bitArray.bitLength(d)&&c(new Ja.exception.invalid("ocb iv must be 128 bits"));var h,i=Ja.mode.ocb2.H,j=Ja.bitArray,k=j.l,l=[0,0,0,0];d=i(a.encrypt(d));var m,n=[];for(e=e||[],f=f||64,h=0;h+4<b.length;h+=4)m=b.slice(h,h+4),l=k(l,m),n=n.concat(k(d,a.encrypt(k(d,m)))),d=i(d);return m=b.slice(h),b=j.bitLength(m),h=a.encrypt(k(d,[0,0,0,b])),m=j.clamp(k(m.concat([0,0,0]),h),b),l=k(l,k(m.concat([0,0,0]),h)),l=a.encrypt(k(l,k(d,i(d)))),e.length&&(l=k(l,g?e:Ja.mode.ocb2.pmac(a,e))),n.concat(j.concat(m,j.clamp(l,f)))},decrypt:function(a,b,d,e,f,g){128!==Ja.bitArray.bitLength(d)&&c(new Ja.exception.invalid("ocb iv must be 128 bits")),f=f||64;var h,i,j=Ja.mode.ocb2.H,k=Ja.bitArray,l=k.l,m=[0,0,0,0],n=j(a.encrypt(d)),o=Ja.bitArray.bitLength(b)-f,p=[];for(e=e||[],d=0;d+4<o/32;d+=4)h=l(n,a.decrypt(l(n,b.slice(d,d+4)))),m=l(m,h),p=p.concat(h),n=j(n);return i=o-32*d,h=a.encrypt(l(n,[0,0,0,i])),h=l(h,k.clamp(b.slice(d),i).concat([0,0,0])),m=l(m,h),m=a.encrypt(l(m,l(n,j(n)))),e.length&&(m=l(m,g?e:Ja.mode.ocb2.pmac(a,e))),k.equal(k.clamp(m,f),k.bitSlice(b,o))||c(new Ja.exception.corrupt("ocb: tag doesn't match")),p.concat(k.clamp(h,i))},pmac:function(a,b){var c,d=Ja.mode.ocb2.H,e=Ja.bitArray,f=e.l,g=[0,0,0,0],h=a.encrypt([0,0,0,0]),h=f(h,d(d(h)));for(c=0;c+4<b.length;c+=4)h=d(h),g=f(g,a.encrypt(f(h,b.slice(c,c+4))));return c=b.slice(c),128>e.bitLength(c)&&(h=f(h,d(h)),c=e.concat(c,[-2147483648,0,0,0])),g=f(g,c),a.encrypt(f(d(f(h,d(h))),g))},H:function(a){return[a[0]<<1^a[1]>>>31,a[1]<<1^a[2]>>>31,a[2]<<1^a[3]>>>31,a[3]<<1^135*(a[0]>>>31)]}},Ja.mode.gcm={name:"gcm",encrypt:function(a,b,c,d,e){var f=b.slice(0);return b=Ja.bitArray,d=d||[],a=Ja.mode.gcm.p(!0,a,f,d,c,e||128),b.concat(a.data,a.tag)},decrypt:function(a,b,d,e,f){var g=b.slice(0),h=Ja.bitArray,i=h.bitLength(g);return f=f||128,e=e||[],f<=i?(b=h.bitSlice(g,i-f),g=h.bitSlice(g,0,i-f)):(b=g,g=[]),a=Ja.mode.gcm.p(Ia,a,g,e,d,f),h.equal(a.tag,b)||c(new Ja.exception.corrupt("gcm: tag doesn't match")),a.data},Z:function(a,b){var c,d,e,f,g,h=Ja.bitArray.l;for(e=[0,0,0,0],f=b.slice(0),c=0;128>c;c++){for((d=0!=(a[Math.floor(c/32)]&1<<31-c%32))&&(e=h(e,f)),g=0!=(1&f[3]),d=3;0<d;d--)f[d]=f[d]>>>1|(1&f[d-1])<<31;f[0]>>>=1,g&&(f[0]^=-520093696)}return e},g:function(a,b,c){var d,e=c.length;for(b=b.slice(0),d=0;d<e;d+=4)b[0]^=4294967295&c[d],b[1]^=4294967295&c[d+1],b[2]^=4294967295&c[d+2],b[3]^=4294967295&c[d+3],b=Ja.mode.gcm.Z(b,a);return b},p:function(a,b,c,d,e,f){var g,h,i,j,k,l,m,n,o=Ja.bitArray;for(l=c.length,m=o.bitLength(c),n=o.bitLength(d),h=o.bitLength(e),g=b.encrypt([0,0,0,0]),96===h?(e=e.slice(0),e=o.concat(e,[1])):(e=Ja.mode.gcm.g(g,[0,0,0,0],e),e=Ja.mode.gcm.g(g,e,[0,0,Math.floor(h/4294967296),4294967295&h])),h=Ja.mode.gcm.g(g,[0,0,0,0],d),k=e.slice(0),d=h.slice(0),a||(d=Ja.mode.gcm.g(g,h,c)),j=0;j<l;j+=4)k[3]++,i=b.encrypt(k),c[j]^=i[0],c[j+1]^=i[1],c[j+2]^=i[2],c[j+3]^=i[3];return c=o.clamp(c,m),a&&(d=Ja.mode.gcm.g(g,h,c)),a=[Math.floor(n/4294967296),4294967295&n,Math.floor(m/4294967296),4294967295&m],d=Ja.mode.gcm.g(g,d,a),i=b.encrypt(e),d[0]^=i[0],d[1]^=i[1],d[2]^=i[2],d[3]^=i[3],{tag:o.bitSlice(d,0,f),data:c}}},Ja.misc.hmac=function(a,b){this.M=b=b||Ja.hash.sha256;var c,d=[[],[]],e=b.prototype.blockSize/32;for(this.n=[new b,new b],a.length>e&&(a=b.hash(a)),c=0;c<e;c++)d[0][c]=909522486^a[c],d[1][c]=1549556828^a[c];this.n[0].update(d[0]),this.n[1].update(d[1]),this.G=new b(this.n[0])},Ja.misc.hmac.prototype.encrypt=Ja.misc.hmac.prototype.mac=function(a){return this.Q&&c(new Ja.exception.invalid("encrypt on already updated hmac called!")),this.update(a),this.digest(a)},Ja.misc.hmac.prototype.reset=function(){this.G=new this.M(this.n[0]),this.Q=Ia},Ja.misc.hmac.prototype.update=function(a){this.Q=!0,this.G.update(a)},Ja.misc.hmac.prototype.digest=function(){var a=this.G.finalize(),a=new this.M(this.n[1]).update(a).finalize();return this.reset(),a},Ja.misc.pbkdf2=function(a,b,d,e,f){d=d||1e3,(0>e||0>d)&&c(Ja.exception.invalid("invalid params to pbkdf2")),"string"==typeof a&&(a=Ja.codec.utf8String.toBits(a)),"string"==typeof b&&(b=Ja.codec.utf8String.toBits(b)),f=f||Ja.misc.hmac,a=new f(a);var g,h,i,j,k=[],l=Ja.bitArray;for(j=1;32*k.length<(e||1);j++){for(f=g=a.encrypt(l.concat(b,[j])),h=1;h<d;h++)for(g=a.encrypt(g),i=0;i<g.length;i++)f[i]^=g[i];k=k.concat(f)}return e&&(k=l.clamp(k,e)),k},Ja.prng=function(a){this.c=[new Ja.hash.sha256],this.i=[0],this.F=0,this.s={},this.C=0,this.K={},this.O=this.d=this.j=this.W=0,this.b=[0,0,0,0,0,0,0,0],this.f=[0,0,0,0],this.A=Ha,this.B=a,this.q=Ia,this.w={progress:{},seeded:{}},this.m=this.V=0,this.t=1,this.u=2,this.S=65536,this.I=[0,48,64,96,128,192,256,384,512,768,1024],this.T=3e4,this.R=80},Ja.prng.prototype={randomWords:function(a,b){var d,e=[];d=this.isReady(b);var f;if(d===this.m&&c(new Ja.exception.notReady("generator isn't seeded")),d&this.u){d=!(d&this.t),f=[];var g,j=0;for(this.O=f[0]=(new Date).valueOf()+this.T,g=0;16>g;g++)f.push(4294967296*Math.random()|0);for(g=0;g<this.c.length&&(f=f.concat(this.c[g].finalize()),j+=this.i[g],this.i[g]=0,!(!d&&this.F&1<<g));g++);for(this.F>=1<<this.c.length&&(this.c.push(new Ja.hash.sha256),this.i.push(0)),this.d-=j,j>this.j&&(this.j=j),this.F++,this.b=Ja.hash.sha256.hash(this.b.concat(f)),this.A=new Ja.cipher.aes(this.b),d=0;4>d&&(this.f[d]=this.f[d]+1|0,!this.f[d]);d++);}for(d=0;d<a;d+=4)0==(d+1)%this.S&&h(this),f=i(this),e.push(f[0],f[1],f[2],f[3]);return h(this),e.slice(0,a)},setDefaultParanoia:function(a,b){0===a&&"Setting paranoia=0 will ruin your security; use it only for testing"!==b&&c("Setting paranoia=0 will ruin your security; use it only for testing"),this.B=a},addEntropy:function(a,b,d){d=d||"user";var e,g,h=(new Date).valueOf(),i=this.s[d],j=this.isReady(),k=0;switch(e=this.K[d],e===Ha&&(e=this.K[d]=this.W++),i===Ha&&(i=this.s[d]=0),this.s[d]=(this.s[d]+1)%this.c.length,typeof a){case"number":b===Ha&&(b=1),this.c[i].update([e,this.C++,1,b,h,1,0|a]);break;case"object":if("[object Uint32Array]"===(d=Object.prototype.toString.call(a))){for(g=[],d=0;d<a.length;d++)g.push(a[d]);a=g}else for("[object Array]"!==d&&(k=1),d=0;d<a.length&&!k;d++)"number"!=typeof a[d]&&(k=1);if(!k){if(b===Ha)for(d=b=0;d<a.length;d++)for(g=a[d];0<g;)b++,g>>>=1;this.c[i].update([e,this.C++,2,b,h,a.length].concat(a))}break;case"string":b===Ha&&(b=a.length),this.c[i].update([e,this.C++,3,b,h,a.length]),this.c[i].update(a);break;default:k=1}k&&c(new Ja.exception.bug("random: addEntropy only supports number, array of numbers or string")),this.i[i]+=b,this.d+=b,j===this.m&&(this.isReady()!==this.m&&f("seeded",Math.max(this.j,this.d)),f("progress",this.getProgress()))},isReady:function(a){return a=this.I[a!==Ha?a:this.B],this.j&&this.j>=a?this.i[0]>this.R&&(new Date).valueOf()>this.O?this.u|this.t:this.t:this.d>=a?this.u|this.m:this.m},getProgress:function(a){return a=this.I[a||this.B],this.j>=a?1:this.d>a?1:this.d/a},startCollectors:function(){this.q||(this.a={loadTimeCollector:j(this,this.aa),mouseCollector:j(this,this.ba),keyboardCollector:j(this,this.$),accelerometerCollector:j(this,this.U),touchCollector:j(this,this.da)},window.addEventListener?(window.addEventListener("load",this.a.loadTimeCollector,Ia),window.addEventListener("mousemove",this.a.mouseCollector,Ia),window.addEventListener("keypress",this.a.keyboardCollector,Ia),window.addEventListener("devicemotion",this.a.accelerometerCollector,Ia),window.addEventListener("touchmove",this.a.touchCollector,Ia)):document.attachEvent?(document.attachEvent("onload",this.a.loadTimeCollector),document.attachEvent("onmousemove",this.a.mouseCollector),document.attachEvent("keypress",this.a.keyboardCollector)):c(new Ja.exception.bug("can't attach event")),this.q=!0)},stopCollectors:function(){this.q&&(window.removeEventListener?(window.removeEventListener("load",this.a.loadTimeCollector,Ia),window.removeEventListener("mousemove",this.a.mouseCollector,Ia),window.removeEventListener("keypress",this.a.keyboardCollector,Ia),window.removeEventListener("devicemotion",this.a.accelerometerCollector,Ia),window.removeEventListener("touchmove",this.a.touchCollector,Ia)):document.detachEvent&&(document.detachEvent("onload",this.a.loadTimeCollector),document.detachEvent("onmousemove",this.a.mouseCollector),document.detachEvent("keypress",this.a.keyboardCollector)),this.q=Ia)},addEventListener:function(a,b){this.w[a][this.V++]=b},removeEventListener:function(a,b){var c,d,e=this.w[a],f=[];for(d in e)e.hasOwnProperty(d)&&e[d]===b&&f.push(d);for(c=0;c<f.length;c++)d=f[c],delete e[d]},$:function(){g(1)},ba:function(a){var b,c;try{b=a.x||a.clientX||a.offsetX||0,c=a.y||a.clientY||a.offsetY||0}catch(d){c=b=0}0!=b&&0!=c&&Ja.random.addEntropy([b,c],2,"mouse"),g(0)},da:function(a){a=a.touches[0]||a.changedTouches[0],Ja.random.addEntropy([a.pageX||a.clientX,a.pageY||a.clientY],1,"touch"),g(0)},aa:function(){g(2)},U:function(a){if(a=a.accelerationIncludingGravity.x||a.accelerationIncludingGravity.y||a.accelerationIncludingGravity.z,window.orientation){var b=window.orientation;"number"==typeof b&&Ja.random.addEntropy(b,1,"accelerometer")}a&&Ja.random.addEntropy(a,2,"accelerometer"),g(0)}},Ja.random=new Ja.prng(6);a:try{var Ka,La,Ma,Na;if(Na="undefined"!=typeof module){var Oa;if(Oa=module.exports){var Pa;try{Pa=require("crypto")}catch(cb){Pa=null}Oa=(La=Pa)&&La.randomBytes}Na=Oa}if(Na)Ka=La.randomBytes(128),Ka=new Uint32Array(new Uint8Array(Ka).buffer),Ja.random.addEntropy(Ka,1024,"crypto['randomBytes']");else if("undefined"!=typeof window&&"undefined"!=typeof Uint32Array){if(Ma=new Uint32Array(32),window.crypto&&window.crypto.getRandomValues)window.crypto.getRandomValues(Ma);else{if(!window.msCrypto||!window.msCrypto.getRandomValues)break a;window.msCrypto.getRandomValues(Ma)}Ja.random.addEntropy(Ma,1024,"crypto['getRandomValues']")}}catch(db){"undefined"!=typeof window&&window.console&&(console.log("There was an error collecting entropy from the browser:"),console.log(db))}Ja.json={defaults:{v:1,iter:1e3,ks:128,ts:64,mode:"ccm",adata:"",cipher:"aes"},Y:function(a,b,d,e){d=d||{},e=e||{};var f,g=Ja.json,h=g.e({iv:Ja.random.randomWords(4,0)},g.defaults);return g.e(h,d),d=h.adata,"string"==typeof h.salt&&(h.salt=Ja.codec.base64.toBits(h.salt)),"string"==typeof h.iv&&(h.iv=Ja.codec.base64.toBits(h.iv)),(!Ja.mode[h.mode]||!Ja.cipher[h.cipher]||"string"==typeof a&&100>=h.iter||64!==h.ts&&96!==h.ts&&128!==h.ts||128!==h.ks&&192!==h.ks&&256!==h.ks||2>h.iv.length||4<h.iv.length)&&c(new Ja.exception.invalid("json encrypt: invalid parameters")),"string"==typeof a?(f=Ja.misc.cachedPbkdf2(a,h),a=f.key.slice(0,h.ks/32),h.salt=f.salt):Ja.ecc&&a instanceof Ja.ecc.elGamal.publicKey&&(f=a.kem(),h.kemtag=f.tag,a=f.key.slice(0,h.ks/32)),"string"==typeof b&&(b=Ja.codec.utf8String.toBits(b)),"string"==typeof d&&(h.adata=d=Ja.codec.utf8String.toBits(d)),f=new Ja.cipher[h.cipher](a),g.e(e,h),e.key=a,h.ct=Ja.mode[h.mode].encrypt(f,b,h.iv,d,h.ts),h},encrypt:function(a,b,c,d){var e=Ja.json,f=e.Y.apply(e,arguments);return e.encode(f)},X:function(a,b,d,e){d=d||{},e=e||{};var f=Ja.json;b=f.e(f.e(f.e({},f.defaults),b),d,!0);var g,h;return g=b.adata,"string"==typeof b.salt&&(b.salt=Ja.codec.base64.toBits(b.salt)),"string"==typeof b.iv&&(b.iv=Ja.codec.base64.toBits(b.iv)),(!Ja.mode[b.mode]||!Ja.cipher[b.cipher]||"string"==typeof a&&100>=b.iter||64!==b.ts&&96!==b.ts&&128!==b.ts||128!==b.ks&&192!==b.ks&&256!==b.ks||!b.iv||2>b.iv.length||4<b.iv.length)&&c(new Ja.exception.invalid("json decrypt: invalid parameters")),"string"==typeof a?(h=Ja.misc.cachedPbkdf2(a,b),a=h.key.slice(0,b.ks/32),b.salt=h.salt):Ja.ecc&&a instanceof Ja.ecc.elGamal.secretKey&&(a=a.unkem(Ja.codec.base64.toBits(b.kemtag)).slice(0,b.ks/32)),"string"==typeof g&&(g=Ja.codec.utf8String.toBits(g)),h=new Ja.cipher[b.cipher](a),g=Ja.mode[b.mode].decrypt(h,b.ct,b.iv,g,b.ts),f.e(e,b),e.key=a,1===d.raw?g:Ja.codec.utf8String.fromBits(g)},decrypt:function(a,b,c,d){var e=Ja.json;return e.X(a,e.decode(b),c,d)},encode:function(a){var b,d="{",e="";for(b in a)if(a.hasOwnProperty(b))switch(b.match(/^[a-z0-9]+$/i)||c(new Ja.exception.invalid("json encode: invalid property name")),d+=e+'"'+b+'":',e=",",typeof a[b]){case"number":case"boolean":d+=a[b];break;case"string":d+='"'+escape(a[b])+'"';break;case"object":d+='"'+Ja.codec.base64.fromBits(a[b],0)+'"';break;default:c(new Ja.exception.bug("json encode: unsupported type"))}return d+"}"},decode:function(a){a=a.replace(/\s/g,""),a.match(/^\{.*\}$/)||c(new Ja.exception.invalid("json decode: this isn't json!")),a=a.replace(/^\{|\}$/g,"").split(/,/);var b,d,e={};for(b=0;b<a.length;b++)(d=a[b].match(/^\s*(?:(["']?)([a-z][a-z0-9]*)\1)\s*:\s*(?:(-?\d+)|"([a-z0-9+\/%*_.@=\-]*)"|(true|false))$/i))||c(new Ja.exception.invalid("json decode: this isn't json!")),
d[3]?e[d[2]]=parseInt(d[3],10):d[4]?e[d[2]]=d[2].match(/^(ct|adata|salt|iv)$/)?Ja.codec.base64.toBits(d[4]):unescape(d[4]):d[5]&&(e[d[2]]="true"===d[5]);return e},e:function(a,b,d){if(a===Ha&&(a={}),b===Ha)return a;for(var e in b)b.hasOwnProperty(e)&&(d&&a[e]!==Ha&&a[e]!==b[e]&&c(new Ja.exception.invalid("required parameter overridden")),a[e]=b[e]);return a},fa:function(a,b){var c,d={};for(c in a)a.hasOwnProperty(c)&&a[c]!==b[c]&&(d[c]=a[c]);return d},ea:function(a,b){var c,d={};for(c=0;c<b.length;c++)a[b[c]]!==Ha&&(d[b[c]]=a[b[c]]);return d}},Ja.encrypt=Ja.json.encrypt,Ja.decrypt=Ja.json.decrypt,Ja.misc.ca={},Ja.misc.cachedPbkdf2=function(a,b){var c,d=Ja.misc.ca;return b=b||{},c=b.iter||1e3,d=d[a]=d[a]||{},c=d[c]=d[c]||{firstSalt:b.salt&&b.salt.length?b.salt.slice(0):Ja.random.randomWords(2,0)},d=b.salt===Ha?c.firstSalt:b.salt,c[d]=c[d]||Ja.misc.pbkdf2(a,d,b.iter),{key:c[d].slice(0),salt:d.slice(0)}};var Qa;k.prototype.am=m,Qa=28,k.prototype.DB=Qa,k.prototype.DM=(1<<Qa)-1,k.prototype.DV=1<<Qa;var Ra=52;k.prototype.FV=Math.pow(2,Ra),k.prototype.F1=Ra-Qa,k.prototype.F2=2*Qa-Ra;var Sa,Ta,Ua="0123456789abcdefghijklmnopqrstuvwxyz",Va=new Array;for(Sa="0".charCodeAt(0),Ta=0;Ta<=9;++Ta)Va[Sa++]=Ta;for(Sa="a".charCodeAt(0),Ta=10;Ta<36;++Ta)Va[Sa++]=Ta;for(Sa="A".charCodeAt(0),Ta=10;Ta<36;++Ta)Va[Sa++]=Ta;J.prototype.convert=K,J.prototype.revert=L,J.prototype.reduce=M,J.prototype.mulTo=N,J.prototype.sqrTo=O,Q.prototype.convert=R,Q.prototype.revert=S,Q.prototype.reduce=T,Q.prototype.mulTo=V,Q.prototype.sqrTo=U,k.prototype.copyTo=p,k.prototype.fromInt=q,k.prototype.fromString=s,k.prototype.clamp=t,k.prototype.dlShiftTo=A,k.prototype.drShiftTo=B,k.prototype.lShiftTo=C,k.prototype.rShiftTo=D,k.prototype.subTo=E,k.prototype.multiplyTo=F,k.prototype.squareTo=G,k.prototype.divRemTo=H,k.prototype.invDigit=P,k.prototype.isEven=W,k.prototype.exp=X,k.prototype.toString=u,k.prototype.negate=v,k.prototype.abs=w,k.prototype.compareTo=x,k.prototype.bitLength=z,k.prototype.mod=I,k.prototype.modPowInt=Y,k.ZERO=r(0),k.ONE=r(1),Z.prototype.init=$,Z.prototype.next=_;var Wa,Xa,Ya,Za=256;if(null==Xa){Xa=new Array,Ya=0;for(var $a;Ya<Za;)$a=Math.floor(65536*Math.random()),Xa[Ya++]=$a>>>8,Xa[Ya++]=255&$a;Ya=0,ca()}fa.prototype.nextBytes=ea,ia.prototype.doPublic=ka,ia.prototype.setPublic=ja,ia.prototype.encrypt=la,module.exports=ia,ha=function(a,b){if(b<a.length+11)throw new Error("Message too long for RSA");for(var c=new Array(b),d=a.length-1;d>=0&&b>0;)c[--b]=a[d--];c[--b]=0;for(var e=new fa,f=new Array;b>2;){for(f[0]=0;0==f[0];)e.nextBytes(f);c[--b]=f[0]}return c[--b]=2,c[--b]=0,new k(c)},ia.prototype.setPublic=function(a,b){if(!(null!=a&&null!=b&&a.length>0&&b.length>0))throw new Error("Invalid RSA public key");this.n=ga(a,16),this.e=parseInt(b,16)},module.exports=ia;var _a=b.Worldpay={};_a.encrypt=na,_a.setPublicKey=ma,_a.validateFields=ua;var ab="",bb="javascript";module.exports=_a,b.true=a}({},function(){return this}());